<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Satellite derived kelp canopy biomass (kg/mÂ²) since 1984 across the coast of California, Oregon and Washington">

<title>CINMS ingest - Kelp canopy biomass</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="../site_libs/jquery-1.12.4/jquery.min.js"></script>
<link href="../site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="../site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="../site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="../site_libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="../site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="../site_libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="../site_libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="../site_libs/HomeButton-0.0.1/home-button.js"></script>
<script src="../site_libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="../site_libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="../site_libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="../site_libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<link href="../site_libs/rdeck-0.4.0/rdeck.css" rel="stylesheet">
<link href="../site_libs/rdeck-0.4.0/vendor/mapbox-gl.css" rel="stylesheet">
<script src="../site_libs/rdeck-0.4.0/vendor/deck.gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/loaders.gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/luma.gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/turf.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/core-js.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/mui.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/nebula.gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/math.gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/react-map-gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/d3-format.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/probe.gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/d3-scale.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/d3-interpolate.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/mjolnir.js.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/emotion.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/stylis.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/gl-matrix.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/d3-array.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/mdi.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/react.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/babel.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/react-dom.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/prop-types.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/mapbox-gl.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/d3-color.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/scheduler.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/d3-hexbin.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/internmap.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/viewport-mercator-project.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/turf-jsts.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/rbush.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/polygon-clipping.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/pbf.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/long.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/lodash.throttle.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/ktx-parse.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/ieee754.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/hammerjs.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/h3-js.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/geojson-rbush.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/earcut.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/clsx.js"></script>
<script src="../site_libs/rdeck-0.4.0/vendor/mapbox.js"></script>
<script src="../site_libs/rdeck-binding-0.4.0.9030/rdeck.js"></script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">CINMS ingest</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#make-hexagon-layers" id="toc-make-hexagon-layers" class="nav-link active" data-scroll-target="#make-hexagon-layers">make hexagon layers</a></li>
  <li><a href="#make-vector-tiles" id="toc-make-vector-tiles" class="nav-link" data-scroll-target="#make-vector-tiles">make vector tiles</a></li>
  <li><a href="#show-vector-tile-map" id="toc-show-vector-tile-map" class="nav-link" data-scroll-target="#show-vector-tile-map">show vector tile map</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Kelp canopy biomass</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>

<div>
  <div class="description">
    Satellite derived kelp canopy biomass (kg/mÂ²) since 1984 across the coast of California, Oregon and Washington
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="make-hexagon-layers" class="level2">
<h2 class="anchored" data-anchor-id="make-hexagon-layers">make hexagon layers</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"lib/common.R"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("crazycapivara/h3-r")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># shelf(</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaftime,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   geojsonio, geojsonlint)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">shelf</span>(h3, mapview, ncdf4, qfes<span class="sc">/</span>rdeck, sf, terra)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># https://crazycapivara.github.io/h3-r/</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>redo <span class="ot">&lt;-</span> F</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>ply_h3_b_geo <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data/kelp_canopy_h3.geojson"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(ply_h3_b_geo)){</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  d_nc <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_data}/knb-lter-sbc.74.17/LandsatKelpBiomass_2022_Q2_withmetadata.nc"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(d_nc)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names(d$var) %&gt;% paste(collapse = ", ")</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># latitude, longitude, year, quarter, biomass, biomass_se, area, area_se, passes, passes5, passes7, passes8</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  x   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"longitude"</span>) <span class="co"># 573515</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  y   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"latitude"</span>)  <span class="co"># 573515</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  yr  <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"year"</span>)    <span class="co"># 154</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  qr  <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"quarter"</span>) <span class="co"># 154</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  b   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"biomass"</span>) <span class="co"># units: kg</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  a   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"area"</span>)    <span class="co"># units: m^2</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  b_a <span class="ot">&lt;-</span> b<span class="sc">/</span>a <span class="co"># kg/m^2</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dim(b) # 573515 x 154</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="co"># remove = F, </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">crs =</span> <span class="dv">4326</span>) </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  h3_resolutions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  p_h3   <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  ply_h3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (res <span class="cf">in</span> h3_resolutions){ <span class="co"># res = h3_resolutions[1]</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign h3_index to each point</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    h3_idx <span class="ot">&lt;-</span> <span class="fu">geo_to_h3</span>(p, res)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    p_h3 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      p_h3,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">id       =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x),</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">h3_res   =</span> res,</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">h3_index =</span> h3_idx) )</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get polygons for unique H3 indexes</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    ply_h3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>      ply_h3,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3_to_geo_boundary_sf</span>(<span class="fu">unique</span>(h3_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">h3_res =</span> res) )</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># p_h3 %&gt;% </span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   filter(h3_res == 3) %&gt;% </span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   {table(.$h3_index)}</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># biomass to tibble</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(b_a) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(b_a)[<span class="dv">1</span>],</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">yr_qr =</span> <span class="fu">glue</span>(<span class="st">"{yr}_{qr}"</span>))</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  tbl_b <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(b_a) <span class="sc">%&gt;%</span> </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>(<span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summarize biomass for all H3 resolutions and indexes</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  h_b <span class="ot">&lt;-</span> p_h3 <span class="sc">%&gt;%</span> </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      tbl_b,  <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>      h3_res, h3_index) <span class="sc">%&gt;%</span> </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_all</span>(<span class="fu">list</span>(mean))</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join biomass to polygons by h3_index</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  ply_h3_b <span class="ot">&lt;-</span> ply_h3 <span class="sc">%&gt;%</span> </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>      h_b,</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"h3_index"</span>, <span class="st">"h3_res"</span>))</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_sf</span>(ply_h3_b, ply_h3_b_geo, <span class="at">delete_dsn =</span> T)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># table(ply_h3_b$h3_res)</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  3     5     7     9 </span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 36   211  1364 13318</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (res <span class="cf">in</span> h3_resolutions){ <span class="co"># res = h3_resolutions[1]</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    geo <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="fu">glue</span>(<span class="st">"data/kelp-canopy_h3-res{res}.geojson"</span>))</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    ply_h3_b <span class="sc">%&gt;%</span> </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(h3_res <span class="sc">==</span> res) <span class="sc">%&gt;%</span> </span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write_sf</span>(geo, <span class="at">delete_dsn =</span> T)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>ply_h3_b <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(ply_h3_b_geo)</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>ply_h3_b <span class="sc">%&gt;%</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(h3_res <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">2022_2</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapView</span>(</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">zcol       =</span> <span class="st">"2022_2"</span>,</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">layer.name =</span> <span class="st">"Kelp biomass&lt;br&gt;2022_2 (kg&amp;#x2fmÂ²)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="htmlwidget-7795bd905017dd2975cd" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-7795bd905017dd2975cd">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-124.5789747114,-124.207982147382,-124.670615561959,-125.503132241405,-125.864395556734,-125.40298064871,-124.5789747114],"lat":[42.7912338806351,43.3490277297844,43.8176884406178,43.7261862647627,43.1687554678818,42.7024483379519,42.7912338806351]}]],[[{"lng":[-124.489276839951,-124.121598709747,-124.5789747114,-125.40298064871,-125.761161092853,-125.304939517403,-124.489276839951],"lat":[41.7523782263461,42.3149858901823,42.7912338806351,42.7024483379519,42.1402273183458,41.6663903198247,41.7523782263461]}]],[[{"lng":[-123.698586239997,-123.299548909741,-123.78541407377,-124.66948483337,-125.057917850083,-124.573018546658,-123.698586239997],"lat":[47.4458116407736,47.9759344453891,48.4149972311069,48.3216666008105,47.7914568448072,47.3546464085937,47.4458116407736]}]],[[{"lng":[-123.78541407377,-123.382429709871,-123.874258159977,-124.768177162593,-125.160281213796,-124.66948483337,-123.78541407377],"lat":[48.4149972311069,48.9389728419686,49.3697960139889,49.2743785205805,48.7502440098243,48.3216666008105,48.4149972311069]}]],[[{"lng":[-123.292429400506,-122.912070222604,-123.370131290448,-124.207982147382,-124.5789747114,-124.121598709747,-123.292429400506],"lat":[42.3941379527797,42.9520832501468,43.4307393754955,43.3490277297844,42.7912338806351,42.3149858901823,42.3941379527797]}]],[[{"lng":[-125.057917850083,-124.66948483337,-125.160281213796,-126.038042589334,-126.415456091377,-125.926253486032,-125.057917850083],"lat":[47.7914568448072,48.3216666008105,48.7502440098243,48.6464036460926,48.1163066674742,47.6899174952512,47.7914568448072]}]],[[{"lng":[-124.315469646214,-123.954256830195,-124.401461228963,-125.208943389866,-125.561098229907,-125.114929465037,-124.315469646214],"lat":[39.6394138050445,40.2107799759194,40.7015982925692,40.6184872250442,40.0475256161981,39.5592564797695,39.6394138050445]}]],[[{"lng":[-123.216380251578,-122.83955755827,-123.292429400506,-124.121598709747,-124.489276839951,-124.037042610339,-123.216380251578],"lat":[41.3452531155024,41.9080326999542,42.3941379527797,42.3149858901823,41.7523782263461,41.2687368750541,41.3452531155024]}]],[[{"lng":[-124.401461228963,-124.037042610339,-124.489276839951,-125.304939517403,-125.660084091528,-125.208943389866,-124.401461228963],"lat":[40.7015982925692,41.2687368750541,41.7523782263461,41.6663903198247,41.0996523030676,40.6184872250442,40.7015982925692]}]],[[{"lng":[-123.141931926788,-122.768583181655,-123.216380251578,-124.037042610339,-124.401461228963,-123.954256830195,-123.141931926788],"lat":[40.2845860772487,40.8519072147692,41.3452531155024,41.2687368750541,40.7015982925692,40.2107799759194,40.2845860772487]}]],[[{"lng":[-123.069034650536,-122.699098867593,-123.141931926788,-123.954256830195,-124.315469646214,-123.873186683595,-123.069034650536],"lat":[39.2126815308057,39.7842308414202,40.2845860772487,40.2107799759194,39.6394138050445,39.1416574846754,39.2126815308057]}]],[[{"lng":[-123.449540095298,-123.061913897477,-123.530712369257,-124.386471536731,-124.764262729772,-124.296252400327,-123.449540095298],"lat":[44.4545998650593,45.0020827003221,45.4653054902617,45.3787087539583,44.831308072054,44.3704063285584,44.4545998650593]}]],[[{"lng":[-123.613707178233,-123.218543990417,-123.698586239997,-124.573018546658,-124.957843326226,-124.478704357391,-123.613707178233],"lat":[46.4624854997846,46.9985890218055,47.4458116407736,47.3546464085937,46.8185204138325,46.3735648164121,46.4624854997846]}]],[[{"lng":[-123.530712369257,-123.139352291117,-123.613707178233,-124.478704357391,-124.859982314112,-124.386471536731,-123.530712369257],"lat":[45.4653054902617,46.0072026708798,46.4624854997846,46.3735648164121,45.8317016847517,45.3787087539583,45.4653054902617]}]],[[{"lng":[-122.997640679775,-122.631058377248,-123.069034650536,-123.873186683595,-124.231246220813,-123.793779700654,-122.997640679775],"lat":[38.1301270885952,38.7055711045939,39.2126815308057,39.1416574846754,38.5663870033524,38.0619541286009,38.1301270885952]}]],[[{"lng":[-122.927704201805,-122.564417357327,-122.997640679775,-123.793779700654,-124.148737325523,-123.7159855169,-122.927704201805],"lat":[37.0375523628605,37.6165382704371,38.1301270885952,38.0619541286009,37.4831218986341,36.9722961501931,37.0375523628605]}]],[[{"lng":[-121.76446624603,-121.389711386419,-121.822972248738,-122.631058377248,-122.997640679775,-122.564417357327,-121.76446624603],"lat":[37.6756938656529,38.2510874690867,38.7673877629194,38.7055711045939,38.1301270885952,37.6165382704371,37.6756938656529]}]],[[{"lng":[-121.707156918451,-121.335881644785,-121.76446624603,-122.564417357327,-122.927704201805,-122.499133245337,-121.707156918451],"lat":[36.5742182968079,37.1531301951624,37.6756938656529,37.6165382704371,37.0375523628605,36.5177842407864,36.5742182968079]}]],[[{"lng":[-121.651008033933,-121.283149693587,-121.707156918451,-122.499133245337,-122.859181238154,-122.435165180479,-121.651008033933],"lat":[35.4636569476396,36.0457057503103,36.5742182968079,36.5177842407864,35.9356276737419,35.4100010685406,35.4636569476396]}]],[[{"lng":[-120.444444242121,-120.069127163356,-120.488201288704,-121.283149693587,-121.651008033933,-121.231482376364,-120.444444242121],"lat":[34.9745632653512,35.5562743725034,36.0933022810262,36.0457057503103,35.4636569476396,34.9295316069288,34.9745632653512]}]],[[{"lng":[-120.401565209856,-120.029766676471,-120.444444242121,-121.231482376364,-121.595984804086,-121.18084785517,-120.401565209856],"lat":[33.847782580886,34.4321846613711,34.9745632653512,34.9295316069288,34.3447444285683,33.8053630780268,33.847782580886]}]],[[{"lng":[-119.20980258942,-118.831067030178,-119.240553696738,-120.029766676471,-120.401565209856,-119.991193444216,-119.20980258942],"lat":[33.3344807169977,33.9182662642462,34.4686221149837,34.4321846613711,33.847782580886,33.3004247660007,33.3344807169977]}]],[[{"lng":[-119.240553696738,-118.858147405307,-119.271934490753,-120.069127163356,-120.444444242121,-120.029766676471,-119.240553696738],"lat":[34.4686221149837,35.0497678532796,35.5950510325263,35.5562743725034,34.9745632653512,34.4321846613711,34.4686221149837]}]],[[{"lng":[-119.179662421327,-118.804528140098,-119.20980258942,-119.991193444216,-120.359538074117,-119.953384115411,-119.179662421327],"lat":[32.1934456033711,32.7794379966387,33.3344807169977,33.3004247660007,32.713755481703,32.1618090529548,32.1934456033711]}]],[[{"lng":[-118.021714994901,-117.63641658555,-118.040386097708,-118.831067030178,-119.20980258942,-118.804528140098,-118.021714994901],"lat":[32.805204901341,33.3881454498849,33.9461724714007,33.9182662642462,33.3344807169977,32.7794379966387,32.805204901341]}]],[[{"lng":[-118.040386097708,-117.651275899718,-118.059439191905,-118.858147405307,-119.240553696738,-118.831067030178,-118.040386097708],"lat":[33.9461724714007,34.5265282280856,35.079775914541,35.0497678532796,34.4686221149837,33.9182662642462,33.9461724714007]}]],[[{"lng":[-116.844971617233,-116.449556353137,-116.851777867387,-117.651275899718,-118.040386097708,-117.63641658555,-116.844971617233],"lat":[33.4076164790938,33.98696146415,34.5478528586117,34.5265282280856,33.9461724714007,33.3881454498849,33.4076164790938]}]],[[{"lng":[-116.838301589285,-116.446827463633,-116.844971617233,-117.63641658555,-118.021714994901,-117.621854049478,-116.838301589285],"lat":[32.2603828211941,32.8422536573139,33.4076164790938,33.3881454498849,32.805204901341,32.2427981797693,32.2603828211941]}]],[[{"lng":[-116.831763734653,-116.444152967859,-116.838301589285,-117.621854049478,-118.003414513653,-117.607579490127,-116.831763734653],"lat":[31.1070150032528,31.6909614533085,32.2603828211941,32.2427981797693,31.6577146432708,31.091345620898,31.1070150032528]}]],[[{"lng":[-115.665656551653,-115.272381670508,-115.660537763558,-116.444152967859,-116.831763734653,-116.441531255566,-115.665656551653],"lat":[30.5418576167629,31.1244432468648,31.7005026286661,31.6909614533085,31.1070150032528,30.5339648969598,30.5418576167629]}]],[[{"lng":[-115.670675154252,-115.281298528424,-115.665656551653,-116.441531255566,-116.825354163328,-116.438960779442,-115.670675154252],"lat":[29.3783946573025,29.9625152759875,30.5418576167629,30.5339648969598,29.9484052517458,29.3721713548385,29.3783946573025]}]],[[{"lng":[-115.675596484038,-115.290041609046,-115.670675154252,-116.438960779442,-116.819069136456,-116.436440052067,-115.675596484038],"lat":[28.2110483725866,28.7962248532818,29.3783946573025,29.3721713548385,28.7854710412063,28.2065114864224,28.2110483725866]}]],[[{"lng":[-114.53833088761,-114.147701187117,-114.522329133379,-115.290041609046,-115.675596484038,-115.298615942978,-114.53833088761],"lat":[27.6240176081429,28.2074465363378,28.7951287210934,28.7962248532818,28.2110483725866,27.6265186121553,27.6240176081429]}]],[[{"lng":[-114.522329133379,-114.127781588427,-114.506012156245,-115.281298528424,-115.670675154252,-115.290041609046,-114.522329133379],"lat":[28.7951287210934,29.3775888810467,29.9628099654987,29.9625152759875,29.3783946573025,28.7962248532818,28.7951287210934]}]],[[{"lng":[-114.554026463669,-114.167237684328,-114.53833088761,-115.298615942978,-115.680423341876,-115.307026368519,-114.554026463669],"lat":[26.4504438117332,27.0343501237742,27.6240176081429,27.6265186121553,27.0407725083235,26.4543601069807,26.4504438117332]}]],[[{"lng":[-113.434528559009,-113.043124814465,-113.408110126007,-114.167237684328,-114.554026463669,-114.186402022316,-113.434528559009],"lat":[25.8488321346101,26.4306796252138,27.0250323798201,27.0343501237742,26.4504438117332,25.8592752853478,25.8488321346101]}]]],null,"Kelp biomass<br>2022_2 (kg&#x2fmÂ²)",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#481964","#00C278","#53CC67","#D9E12C","#007B97","#007B97","#00588B","#009B95","#B2DC3C","#008C98","#481964","#2D4580","#006A92","#403173","#00588B","#481964","#00C278","#00588B","#006A92","#481964"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>16&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>17&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>18&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>1.8210271&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>19&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>2.1498059&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>20&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>2.7132666&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>21&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>1.0678955&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.9846167&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>23&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.5392927&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>24&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>1.2885710&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>25&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>2.3727315&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>26&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>1.1254320&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>27&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>28&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.4324846&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>29&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.8632995&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>30&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.2079900&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>31&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.5437998&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>32&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>33&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>1.8150429&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>34&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.6439107&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>35&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.8892758&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>36&emsp;<\/td><\/tr><tr><td>1<\/td><th>2022_2&emsp;<\/th><td>0.0000000&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","1.82102707840857","2.1498059251543","2.71326656856499","1.0678955399392","0.984616697044143","0.539292729477845","1.28857103091946","2.37273145584759","1.12543199844131","0","0.432484634139031","0.863299529740962","0.207989952577267","0.543799811337639","0","1.81504293239939","0.643910746257749","0.88927583884977","0"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-126.415456091377,25.8488321346101,-113.043124814465,49.3697960139889,true,"Kelp biomass<br>2022_2 (kg&#x2fmÂ²)","Zoom to Kelp biomass<br>2022_2 (kg&#x2fmÂ²)","<strong> Kelp biomass<br>2022_2 (kg&#x2fmÂ²) <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"Kelp biomass<br>2022_2 (kg&#x2fmÂ²)",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055 , #4B0055 0%, #2E447F 18.4279718695109%, #007996 36.8559437390218%, #01A890 55.2839156085328%, #4ACA6B 73.7118874780437%, #CFE031 92.1398593475546%, #FDE333 "],"labels":["0.0","0.5","1.0","1.5","2.0","2.5"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"Kelp biomass<br>2022_2 (kg&#x2fmÂ²)","extra":{"p_1":0,"p_n":0.921398593475546},"layerId":null,"className":"info legend","group":"Kelp biomass<br>2022_2 (kg&#x2fmÂ²)"}]}],"limits":{"lat":[25.8488321346101,49.3697960139889],"lng":[-126.415456091377,-113.043124814465]},"fitBounds":[25.8488321346101,-126.415456091377,49.3697960139889,-113.043124814465,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
<section id="make-vector-tiles" class="level2">
<h2 class="anchored" data-anchor-id="make-vector-tiles">make vector tiles</h2>
<ul>
<li>example: <a href="https://github.com/mapbox/tippecanoe#show-countries-at-low-zoom-levels-but-states-at-higher-zoom-levels">mapbox/tippecanoe</a> - Show countries at low zoom levels but states at higher zoom levels</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here("data")</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># /Users/bbest/Github/noaa-onms/cinms-ingest/data</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /Users/bbest/Github/noaa-onms/cinms-ingest/data</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="va">opts</span><span class="op">=</span><span class="kw">`</span><span class="ex">--no-tile-compression</span> <span class="at">--force</span><span class="kw">`</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-z3</span> <span class="at">-o</span> kelp-canopy_z3.mbtiles <span class="at">--coalesce-densest-as-needed</span> kelp-canopy_h3-res3.geojson</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-Z3</span> <span class="at">-z5</span> <span class="at">-o</span> kelp-canopy_z5.mbtiles <span class="at">--coalesce-densest-as-needed</span>  kelp-canopy_h3-res5.geojson</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-Z5</span> <span class="at">-z7</span> <span class="at">-o</span> kelp-canopy_z7.mbtiles <span class="at">--coalesce-densest-as-needed</span>  kelp-canopy_h3-res7.geojson</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-Z7</span> <span class="at">-z14</span> <span class="at">-o</span> kelp-canopy_z9.mbtiles <span class="at">--coalesce-densest-as-needed</span>  kelp-canopy_h3-res9.geojson</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># tile-join -f -o kelp-canopy.mbtiles kelp-canopy_z3.mbtiles kelp-canopy_z5.mbtiles kelp-canopy_z7.mbtiles kelp-canopy_z9.mbtiles</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ex">tile-join</span> <span class="at">--no-tile-compression</span> <span class="at">--force</span> <span class="at">-e</span> kelp-canopy_tiles kelp-canopy_z3.mbtiles kelp-canopy_z5.mbtiles kelp-canopy_z7.mbtiles kelp-canopy_z9.mbtiles</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> kelp-canopy_z<span class="pp">*</span>.mbtiles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="show-vector-tile-map" class="level2">
<h2 class="anchored" data-anchor-id="show-vector-tile-map">show vector tile map</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLD: serve CORS files locally</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(beakr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an new beakr instance</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>beakr <span class="ot">&lt;-</span> <span class="fu">newBeakr</span>()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># beakr pipeline</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>beakr <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enable CORS</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cors</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Respond to GET requests at the "/hi" route</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">httpGET</span>(<span class="at">path =</span> <span class="st">"/hi"</span>, <span class="cf">function</span>(req, res, err) {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Hello, World!"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Respond to GET requests at the "/bye" route</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">httpGET</span>(<span class="at">path =</span> <span class="st">"/bye"</span>, <span class="cf">function</span>(req, res, err) {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Farewell, my friends."</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Host the directory of static files</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">serveStaticFiles</span>(<span class="st">"/data"</span>, <span class="fu">here</span>(<span class="st">"data"</span>), <span class="at">verbose =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Start the server on port 25118</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">listen</span>(<span class="at">host =</span> <span class="st">"127.0.0.1"</span>, <span class="at">port =</span> <span class="dv">25118</span>, <span class="at">daemon =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># POINT YOUR BROWSER AT:</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># * http://127.0.0.1:25118/data/my_file.txt</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># THEN, STOP THE SERVER WITH stopServer(beakr)</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop the beakr instance server</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">stopServer</span>(beakr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shelf</span>(beakr, crul, rdeck, viridis)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mb_token <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"~/My Drive/private/mapbox_token_bdbest.txt"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mb_token &lt;- readLines("/share/data/mapbox_token_bdbest.txt")</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">rdeck.mapbox_access_token =</span> mb_token)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># servr::httd()</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mvt_url &lt;- "http://127.0.0.1:4321/data/kelp-canopy_tiles/{z}/{x}/{y}.pbf"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># mvt_url &lt;- "http://127.0.0.1:25118/data/kelp-canopy_tiles/{z}/{x}/{y}.pbf"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>mvt_url <span class="ot">&lt;-</span> <span class="st">"https://noaa-onms.github.io/cinms-ingest/data/kelp-canopy_tiles/{z}/{x}/{y}.pbf"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>b_max <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">pull</span>(ply_h3_b, <span class="st">`</span><span class="at">2022_2</span><span class="st">`</span>))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(ply_h3_b)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rdeck</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">map_style =</span> <span class="fu">mapbox_dark</span>(),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial_bounds =</span> bb) <span class="sc">%&gt;%</span> </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_mvt_layer</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">id   =</span> <span class="st">"kelp_biomass"</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Kelp Biomass"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mvt_url,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">get_fill_color =</span> <span class="fu">scale_color_linear</span>(</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"2022_2"</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">palette =</span> <span class="fu">viridis</span>(<span class="dv">6</span>, <span class="at">alpha=</span><span class="fl">0.5</span>),</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, b_max)),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">auto_highlight =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">pickable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">"2022_2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-ccac02d05af9793ff5e8" style="width:100%;height:464px;" class="rdeck html-widget"></div>
<script type="application/json" data-for="htmlwidget-ccac02d05af9793ff5e8">{"x":{"theme":"kepler","deckgl":{"initialBounds":[-126.415456,25.848832,-113.043125,49.369796],"initialViewState":{"longitude":0,"latitude":0,"zoom":1,"pitch":0,"bearing":0},"controller":true,"pickingRadius":0,"useDevicePixels":true,"blendingMode":"normal"},"mapgl":{"mapStyle":"mapbox://styles/mapbox/dark-v10","mapboxAccessToken":"pk.eyJ1IjoiYmRiZXN0IiwiYSI6ImNqeTQzcjMzYjE2MnMzb3AyaXBmOWZueG4ifQ.kOxbgvSal1U-3LaYKOo3rw"},"layers":[{"type":"MVTLayer","id":"kelp_biomass","name":"Kelp Biomass","groupName":null,"data":"https://noaa-onms.github.io/cinms-ingest/data/kelp-canopy_tiles/{z}/{x}/{y}.pbf","visible":true,"pickable":true,"opacity":1,"wrapLongitude":false,"positionFormat":"XYZ","colorFormat":"RGBA","autoHighlight":true,"highlightColor":"#00008080","getTileData":null,"extent":null,"tileSize":512,"maxZoom":null,"minZoom":0,"maxCacheSize":null,"maxCacheByteSize":null,"refinementStrategy":"best-available","zRange":null,"maxRequests":6,"zoomOffset":0,"filled":true,"stroked":true,"lineWidthMaxPixels":9.00719925474099e+15,"lineWidthMinPixels":0,"lineWidthScale":1,"lineWidthUnits":"meters","pointRadiusMaxPixels":9.00719925474099e+15,"pointRadiusMinPixels":0,"pointRadiusScale":1,"pointRadiusUnits":"meters","pointAntialiasing":true,"pointBillboard":false,"getFillColor":{"scale":"linear","legend":true,"col":"2022_2","unknown":"#000000","dataType":"geojson","domain":[0,1.1974833802456,2.3949667604912,3.5924501407368,4.7899335209824,5.987416901228,7.1849002814736,8.3823836617192,9.57986704196481,10.7773504222104],"palette":["#44015480","#452B7080","#404A8880","#37678C80","#2B828C80","#289D8780","#4CB57580","#74CC5880","#B9DC4280","#FDE72580"],"ticks":["0.00","2.16","4.31","6.47","8.62","10.78"],"scaleBy":"2022_2","type":"accessor"},"getLineColor":"#000000ff","getLineWidth":1,"getPointRadius":1,"iconAtlas":null,"iconMapping":[],"iconSizeMaxPixels":9.00719925474099e+15,"iconSizeMinPixels":0,"iconSizeScale":1,"iconSizeUnits":"pixels","iconAlphaCutoff":0.05,"iconBillboard":true,"getIcon":{"col":"icon","dataType":"geojson","type":"accessor"},"getIconAngle":0,"getIconColor":"#000000ff","getIconPixelOffset":[0,0],"getIconSize":1,"textSizeMaxPixels":9.00719925474099e+15,"textSizeMinPixels":0,"textSizeScale":1,"textSizeUnits":"pixels","textBackground":false,"textBackgroundPadding":[0,0,0,0],"textFontFamily":"Roboto, Helvetica, Arial, san-serif","textFontWeight":"normal","textLineHeight":1,"textMaxWidth":-1,"textOutlineColor":"#000000ff","textOutlineWidth":0,"textWordBreak":"break-word","textBillboard":true,"textFontSettings":[],"getText":{"col":"text","dataType":"geojson","type":"accessor"},"getTextAngle":0,"getTextColor":"#000000ff","getTextPixelOffset":[0,0],"getTextSize":32,"getTextAnchor":"middle","getTextAlignmentBaseline":"center","getTextBackgroundColor":"#ffffffff","getTextBorderColor":"#000000ff","getTextBorderWidth":0,"lineJointRounded":false,"lineCapRounded":false,"lineMiterLimit":4,"lineBillboard":false,"extruded":false,"wireframe":false,"elevationScale":1,"material":true,"getElevation":1000,"pointType":"circle","uniqueIdProperty":"","highlightedFeatureId":null,"binary":true,"blendingMode":"normal","visibilityToggle":true,"tooltip":{"cols":["2022_2"],"dataType":"geojson"}}],"layerSelector":false,"lazyLoad":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb5" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Kelp canopy biomass"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Satellite derived kelp canopy biomass (kg/mÂ²) since 1984 across the coast of California, Oregon and Washington"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "/images/kelp-canopy_h3-map.png"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> T, <span class="at">message =</span> F, <span class="at">warning =</span> F)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## make hexagon layers</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"lib/common.R"</span>))</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("crazycapivara/h3-r")</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># shelf(</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   leaftime,</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   geojsonio, geojsonlint)</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="fu">shelf</span>(h3, mapview, ncdf4, qfes<span class="sc">/</span>rdeck, sf, terra)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># https://crazycapivara.github.io/h3-r/</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>redo <span class="ot">&lt;-</span> F</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>ply_h3_b_geo <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data/kelp_canopy_h3.geojson"</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(ply_h3_b_geo)){</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  d_nc <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{dir_data}/knb-lter-sbc.74.17/LandsatKelpBiomass_2022_Q2_withmetadata.nc"</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">nc_open</span>(d_nc)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># names(d$var) %&gt;% paste(collapse = ", ")</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># latitude, longitude, year, quarter, biomass, biomass_se, area, area_se, passes, passes5, passes7, passes8</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  x   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"longitude"</span>) <span class="co"># 573515</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  y   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"latitude"</span>)  <span class="co"># 573515</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  yr  <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"year"</span>)    <span class="co"># 154</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  qr  <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"quarter"</span>) <span class="co"># 154</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  b   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"biomass"</span>) <span class="co"># units: kg</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  a   <span class="ot">&lt;-</span> <span class="fu">ncvar_get</span>(d, <span class="st">"area"</span>)    <span class="co"># units: m^2</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  b_a <span class="ot">&lt;-</span> b<span class="sc">/</span>a <span class="co"># kg/m^2</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dim(b) # 573515 x 154</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="co"># remove = F, </span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">crs =</span> <span class="dv">4326</span>) </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  h3_resolutions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  p_h3   <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  ply_h3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (res <span class="cf">in</span> h3_resolutions){ <span class="co"># res = h3_resolutions[1]</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign h3_index to each point</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    h3_idx <span class="ot">&lt;-</span> <span class="fu">geo_to_h3</span>(p, res)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    p_h3 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>      p_h3,</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">id       =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x),</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">h3_res   =</span> res,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">h3_index =</span> h3_idx) )</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get polygons for unique H3 indexes</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    ply_h3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>      ply_h3,</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">h3_to_geo_boundary_sf</span>(<span class="fu">unique</span>(h3_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>          <span class="at">h3_res =</span> res) )</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># p_h3 %&gt;% </span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   filter(h3_res == 3) %&gt;% </span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   {table(.$h3_index)}</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># biomass to tibble</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(b_a) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(b_a)[<span class="dv">1</span>],</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">yr_qr =</span> <span class="fu">glue</span>(<span class="st">"{yr}_{qr}"</span>))</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  tbl_b <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(b_a) <span class="sc">%&gt;%</span> </span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>(<span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>)</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># summarize biomass for all H3 resolutions and indexes</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>  h_b <span class="ot">&lt;-</span> p_h3 <span class="sc">%&gt;%</span> </span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>      tbl_b,  <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>      h3_res, h3_index) <span class="sc">%&gt;%</span> </span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise_all</span>(<span class="fu">list</span>(mean))</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join biomass to polygons by h3_index</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>  ply_h3_b <span class="ot">&lt;-</span> ply_h3 <span class="sc">%&gt;%</span> </span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>      h_b,</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"h3_index"</span>, <span class="st">"h3_res"</span>))</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_sf</span>(ply_h3_b, ply_h3_b_geo, <span class="at">delete_dsn =</span> T)</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># table(ply_h3_b$h3_res)</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  3     5     7     9 </span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 36   211  1364 13318</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (res <span class="cf">in</span> h3_resolutions){ <span class="co"># res = h3_resolutions[1]</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    geo <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="fu">glue</span>(<span class="st">"data/kelp-canopy_h3-res{res}.geojson"</span>))</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    ply_h3_b <span class="sc">%&gt;%</span> </span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(h3_res <span class="sc">==</span> res) <span class="sc">%&gt;%</span> </span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write_sf</span>(geo, <span class="at">delete_dsn =</span> T)</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>ply_h3_b <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(ply_h3_b_geo)</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>ply_h3_b <span class="sc">%&gt;%</span></span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(h3_res <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">2022_2</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapView</span>(</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">zcol       =</span> <span class="st">"2022_2"</span>,</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">layer.name =</span> <span class="st">"Kelp biomass&lt;br&gt;2022_2 (kg&amp;#x2fmÂ²)"</span>)</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a><span class="fu">## make vector tiles</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>example: <span class="co">[</span><span class="ot">mapbox/tippecanoe</span><span class="co">](https://github.com/mapbox/tippecanoe#show-countries-at-low-zoom-levels-but-states-at-higher-zoom-levels)</span> - Show countries at low zoom levels but states at higher zoom levels</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{bash, eval=F}</span></span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a><span class="co"># here("data")</span></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a><span class="co"># /Users/bbest/Github/noaa-onms/cinms-ingest/data</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /Users/bbest/Github/noaa-onms/cinms-ingest/data</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a><span class="va">opts</span><span class="op">=</span><span class="kw">`</span><span class="ex">--no-tile-compression</span> <span class="at">--force</span><span class="kw">`</span></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-z3</span> <span class="at">-o</span> kelp-canopy_z3.mbtiles <span class="at">--coalesce-densest-as-needed</span> kelp-canopy_h3-res3.geojson</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-Z3</span> <span class="at">-z5</span> <span class="at">-o</span> kelp-canopy_z5.mbtiles <span class="at">--coalesce-densest-as-needed</span>  kelp-canopy_h3-res5.geojson</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-Z5</span> <span class="at">-z7</span> <span class="at">-o</span> kelp-canopy_z7.mbtiles <span class="at">--coalesce-densest-as-needed</span>  kelp-canopy_h3-res7.geojson</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a><span class="ex">tippecanoe</span> <span class="va">$opts</span> <span class="at">-Z7</span> <span class="at">-z14</span> <span class="at">-o</span> kelp-canopy_z9.mbtiles <span class="at">--coalesce-densest-as-needed</span>  kelp-canopy_h3-res9.geojson</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a><span class="co"># tile-join -f -o kelp-canopy.mbtiles kelp-canopy_z3.mbtiles kelp-canopy_z5.mbtiles kelp-canopy_z7.mbtiles kelp-canopy_z9.mbtiles</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a><span class="ex">tile-join</span> <span class="at">--no-tile-compression</span> <span class="at">--force</span> <span class="at">-e</span> kelp-canopy_tiles kelp-canopy_z3.mbtiles kelp-canopy_z5.mbtiles kelp-canopy_z7.mbtiles kelp-canopy_z9.mbtiles</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> kelp-canopy_z<span class="pp">*</span>.mbtiles</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a><span class="fu">## show vector tile map</span></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=F}</span></span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a><span class="co"># OLD: serve CORS files locally</span></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(beakr)</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an new beakr instance</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>beakr <span class="ot">&lt;-</span> <span class="fu">newBeakr</span>()</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a><span class="co"># beakr pipeline</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>beakr <span class="sc">%&gt;%</span></span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enable CORS</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cors</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Respond to GET requests at the "/hi" route</span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">httpGET</span>(<span class="at">path =</span> <span class="st">"/hi"</span>, <span class="cf">function</span>(req, res, err) {</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Hello, World!"</span>)</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Respond to GET requests at the "/bye" route</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">httpGET</span>(<span class="at">path =</span> <span class="st">"/bye"</span>, <span class="cf">function</span>(req, res, err) {</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Farewell, my friends."</span>)</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Host the directory of static files</span></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a> <span class="fu">serveStaticFiles</span>(<span class="st">"/data"</span>, <span class="fu">here</span>(<span class="st">"data"</span>), <span class="at">verbose =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Start the server on port 25118</span></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">listen</span>(<span class="at">host =</span> <span class="st">"127.0.0.1"</span>, <span class="at">port =</span> <span class="dv">25118</span>, <span class="at">daemon =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a><span class="co"># POINT YOUR BROWSER AT:</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a><span class="co"># * http://127.0.0.1:25118/data/my_file.txt</span></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a><span class="co"># THEN, STOP THE SERVER WITH stopServer(beakr)</span></span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Stop the beakr instance server</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a><span class="fu">stopServer</span>(beakr)</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a><span class="fu">shelf</span>(beakr, crul, rdeck, viridis)</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>mb_token <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"~/My Drive/private/mapbox_token_bdbest.txt"</span>)</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a><span class="co"># mb_token &lt;- readLines("/share/data/mapbox_token_bdbest.txt")</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">rdeck.mapbox_access_token =</span> mb_token)</span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a><span class="co"># servr::httd()</span></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a><span class="co"># mvt_url &lt;- "http://127.0.0.1:4321/data/kelp-canopy_tiles/{z}/{x}/{y}.pbf"</span></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a><span class="co"># mvt_url &lt;- "http://127.0.0.1:25118/data/kelp-canopy_tiles/{z}/{x}/{y}.pbf"</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>mvt_url <span class="ot">&lt;-</span> <span class="st">"https://noaa-onms.github.io/cinms-ingest/data/kelp-canopy_tiles/{z}/{x}/{y}.pbf"</span></span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>b_max <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">pull</span>(ply_h3_b, <span class="st">`</span><span class="at">2022_2</span><span class="st">`</span>))</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(ply_h3_b)</span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a><span class="fu">rdeck</span>(</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>  <span class="at">map_style =</span> <span class="fu">mapbox_dark</span>(),</span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">initial_bounds =</span> bb) <span class="sc">%&gt;%</span> </span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_mvt_layer</span>(</span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>    <span class="at">id   =</span> <span class="st">"kelp_biomass"</span>,</span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Kelp Biomass"</span>,</span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mvt_url,</span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">get_fill_color =</span> <span class="fu">scale_color_linear</span>(</span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"2022_2"</span>,</span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>      <span class="at">palette =</span> <span class="fu">viridis</span>(<span class="dv">6</span>, <span class="at">alpha=</span><span class="fl">0.5</span>),</span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, b_max)),</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>    <span class="at">auto_highlight =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>    <span class="at">pickable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>    <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">"2022_2"</span>))</span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>